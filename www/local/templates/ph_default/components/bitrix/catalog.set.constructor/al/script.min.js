BX.namespace("BX.Catalog.SetConstructor"),BX.Catalog.SetConstructor=function(){var t=function(t){this.numSliderItems=t.numSliderItems||0,this.numSetItems=t.numSetItems||0,this.jsId=t.jsId||"",this.ajaxPath=t.ajaxPath||"",this.currency=t.currency||"",this.lid=t.lid||"",this.iblockId=t.iblockId||"",this.basketUrl=t.basketUrl||"",this.setIds=t.setIds||null,this.offersCartProps=t.offersCartProps||null,this.itemsRatio=t.itemsRatio||null,this.noFotoSrc=t.noFotoSrc||"",this.messages=t.messages,this.mainElementPrice=t.mainElementPrice||0,this.mainElementOldPrice=t.mainElementOldPrice||0,this.mainElementDiffPrice=t.mainElementDiffPrice||0,this.mainElementBasketQuantity=t.mainElementBasketQuantity||1,this.parentCont=BX(t.parentContId)||null,this.sliderItemsCont=this.parentCont.querySelector("[data-role='set-other-items']"),this.setItemsCont=this.parentCont.querySelector("[data-role='set-items']"),this.setPriceCont=this.parentCont.querySelector("[data-role='set-price']"),this.setOldPriceCont=this.parentCont.querySelector("[data-role='set-old-price']"),this.setDiffPriceCont=this.parentCont.querySelector("[data-role='set-diff-price']"),this.notAvailProduct=this.sliderItemsCont.querySelector("[data-not-avail='yes']"),this.emptySetMessage=this.parentCont.querySelector("[data-set-message='empty-set']"),BX.bindDelegate(this.setItemsCont,"click",{attribute:"data-role"},BX.proxy(this.deleteFromSet,this)),BX.bindDelegate(this.sliderItemsCont,"click",{attribute:"data-role"},BX.proxy(this.addToSet,this));var e=this.parentCont.querySelector("[data-role='set-buy-btn']");BX.bind(e,"click",BX.proxy(this.addToBasket,this)),this.generateSliderStyles()};return t.prototype.generateSliderStyles=function(){var t=BX.create("style",{html:".bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+240*this.numSliderItems+"px}.bx-catalog-set-item-container-"+this.jsId+"{width: "+100/this.numSliderItems+"%;}@media (max-width:767px){.bx-catalog-set-topsale-slids-"+this.jsId+"{width: "+240*this.numSliderItems+"px;}}",attrs:{id:"bx-set-const-style-"+this.jsId}});BX("bx-set-const-style-"+this.jsId)&&BX.remove(BX("bx-set-const-style-"+this.jsId)),this.parentCont.appendChild(t)},t.prototype.deleteFromSet=function(){var t,e,a,i,s,r,d,n,c,l,o,m,h,p,u,b=BX.proxy_context;if(b&&b.hasAttribute("data-role")&&"set-delete-btn"==b.getAttribute("data-role")){if(t=b.parentNode.parentNode,e=t.getAttribute("data-id"),a=t.getAttribute("data-name"),i=t.getAttribute("data-url"),s=t.getAttribute("data-img"),r=t.getAttribute("data-print-price"),d=t.getAttribute("data-price"),n=t.getAttribute("data-print-old-price"),itemPrintDiffPrice=t.getAttribute("data-diff-print-price"),c=t.getAttribute("data-old-price"),l=t.getAttribute("data-diff-price"),o=t.getAttribute("data-measure"),m=t.getAttribute("data-quantity"),u=BX.create("div",{attrs:{className:"catalog_item catalog_item__inner bx-catalog-set-item-container bx-catalog-set-item-container-"+this.jsId,"data-id":e,"data-img":s||"","data-url":i,"data-name":a,"data-print-price":r,"data-print-old-price":n,"data-diff-print-price":itemPrintDiffPrice,"data-price":d,"data-old-price":c,"data-diff-price":l,"data-measure":o,"data-quantity":m},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-img-container"},children:[BX.create("img",{attrs:{src:s||this.noFotoSrc,className:"img-responsive"}})]})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-title"},children:[BX.create("a",{attrs:{href:i},html:a})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price clearfix"},children:[BX.create("div",{attrs:{className:"bx-catalog-set-item-price-new price__pdv"},html:r}),BX.create("div",{attrs:{className:"bx-catalog-set-item-price-dics price__pdd js-price_pdd-2"},html:d!=c?"- "+itemPrintDiffPrice:""})]}),BX.create("div",{attrs:{className:"bx-catalog-set-item-add-btn clearfix"},children:[BX.create("a",{attrs:{className:"btn-add catalog_item__add2cart btn add2cart","data-role":"set-add-btn"},html:this.messages.ADD_BUTTON})]})]})]}),d==c){var f=BX.findChild(u,{class:"bx-catalog-set-item-price-dics"},!0);BX.remove(f)}for(this.notAvailProduct?this.sliderItemsCont.insertBefore(u,this.notAvailProduct):this.sliderItemsCont.appendChild(u),this.numSliderItems++,this.numSetItems--,this.generateSliderStyles(),BX.remove(t),h=0,p=this.setIds.length;h<p;h++)this.setIds[h]==e&&this.setIds.splice(h,1);this.recountPrice(),this.numSetItems<=0&&this.emptySetMessage&&BX.adjust(this.emptySetMessage,{style:{display:"inline-block"},html:this.messages.EMPTY_SET})}},t.prototype.addToSet=function(){var t,e,a,i,s,r,d,n,c,l,o,m,h,p=BX.proxy_context;p&&p.hasAttribute("data-role")&&"set-add-btn"==p.getAttribute("data-role")&&(t=p.parentNode.parentNode.parentNode,e=t.getAttribute("data-id"),a=t.getAttribute("data-name"),i=t.getAttribute("data-url"),s=t.getAttribute("data-img"),r=t.getAttribute("data-print-price"),d=t.getAttribute("data-price"),n=t.getAttribute("data-print-old-price"),itemPrintDiffPrice=t.getAttribute("data-diff-print-price"),c=t.getAttribute("data-old-price"),l=t.getAttribute("data-diff-price"),o=t.getAttribute("data-measure"),m=t.getAttribute("data-quantity"),h=BX.create("tr",{attrs:{"data-id":e,"data-img":s||"","data-url":i,"data-name":a,"data-print-price":r,"data-print-old-price":n,"data-diff-print-price":itemPrintDiffPrice,"data-price":d,"data-old-price":c,"data-diff-price":l,"data-measure":o,"data-quantity":m},children:[BX.create("td",{attrs:{className:"bx-added-item-table-cell-img"},children:[BX.create("img",{attrs:{src:s||this.noFotoSrc,className:"img-responsive"}})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-itemname"},children:[BX.create("a",{attrs:{href:i,className:"tdn"},html:a}),BX.create("br"),BX.create("span",{html:this.messages.MEASURE_NUM+m+" "+o})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-price"},children:[BX.create("span",{attrs:{className:"bx-added-item-old-price price__pv"},html:d!=c?n:""}),BX.create("br"),BX.create("span",{attrs:{className:"bx-added-item-new-price price__pdv"},html:r})]}),BX.create("td",{attrs:{className:"bx-added-item-table-cell-del"},children:[BX.create("div",{attrs:{className:"bx-added-item-delete","data-role":"set-delete-btn"}})]})]}),this.setItemsCont.appendChild(h),this.numSliderItems--,this.numSetItems++,this.generateSliderStyles(),BX.remove(t),this.setIds.push(e),this.recountPrice(),this.numSetItems>0&&this.emptySetMessage&&BX.adjust(this.emptySetMessage,{style:{display:"none"},html:""}))},t.prototype.recountPrice=function(){var t,e,a,i=this.mainElementPrice*this.mainElementBasketQuantity,s=this.mainElementOldPrice*this.mainElementBasketQuantity,r=this.mainElementDiffPrice*this.mainElementBasketQuantity,d=BX.findChildren(this.setItemsCont,{tagName:"tr"},!0);if(d)for(t=0,e=d.length;t<e;t++)a=Number(d[t].getAttribute("data-quantity"))||1,i+=Number(d[t].getAttribute("data-price"))*a,s+=Number(d[t].getAttribute("data-old-price"))*a,r+=Number(d[t].getAttribute("data-diff-price"))*a;this.setPriceCont.innerHTML=BX.Currency.currencyFormat(i,this.currency,!0),Math.floor(100*r)>0?(this.setOldPriceCont.innerHTML=BX.Currency.currencyFormat(s,this.currency,!0),this.setDiffPriceCont.innerHTML=BX.Currency.currencyFormat(r,this.currency,!0)):(this.setOldPriceCont.innerHTML="",this.setDiffPriceCont.innerHTML="")},t.prototype.addToBasket=function(){var t=BX.proxy_context;BX.showWait(t.parentNode),BX.ajax.post(this.ajaxPath,{sessid:BX.bitrix_sessid(),action:"catalogSetAdd2Basket",set_ids:this.setIds,lid:this.lid,iblockId:this.iblockId,setOffersCartProps:this.offersCartProps,itemsRatio:this.itemsRatio},BX.proxy(function(t){BX.closeWait(),document.location.href=this.basketUrl},this))},t}(),$(document).ready(function(){$(".bx-added-item-table-container").scrollbar({scrollx:"none"}),$(".bx-modal-container").find(".bx-catalog-set-topsale-slider-container").scrollbar({showArrows:!0,scrollx:$(".bx-modal-container").find(".picbox__bar"),scrollStep:220})}),$(document).on("click",".bx-constructor-container-result .buy1click",function(){var t=$(this),e=t.closest(".bx-modal-container").find(".js-main-elem-set").data("elemmain"),a=t.closest(".bx-modal-container").find(".js-main-elem-set").data("id");t.closest(".bx-modal-container").find(".bx-added-item-table-container").find("tr").each(function(){e+=", ["+$(this).data("id")+"] "+$(this).data("name"),a+=", "+$(this).data("id")});var i={RS_EXT_FIELD_0:e,RS_ORDER_IDS:a};t.attr("data-insert_data",i),t.data("insert_data",i)}),$(document).on("click",".show_more_set",function(){return $(this).closest(".bx-modal-container").find(".bx-catalog-set-topsale-slider-box").show(),$(this).hide(),!1});