function drawPlacemark(e,s){void 0!=window.google?e.each(function(){$(this).is(":visible")?s[$(this).data("id")].setVisible(!0):s[$(this).data("id")].setVisible(!1)}):void 0!=window.ymaps&&e.each(function(){$(this).is(":visible")?s[$(this).data("id")].options.set("visible",!0):s[$(this).data("id")].options.set("visible",!1)})}function rsGoproShops_initYandexMaps(){var e,s=$(".js-shops_list").find(".js-item"),t=[0,0],a={};s.each(function(){var e=$(this).data("coords").split(",");t[0]=t[0]+parseFloat(e[0]),t[1]=t[1]+parseFloat(e[1])}),t[0]=t[0]/s.length,t[1]=t[1]/s.length;var e,a={};return ymaps.ready(function(){e=new ymaps.Map("rsMapShops",{center:t,zoom:14,type:"yandex#publicMap",behaviors:["default","scrollZoom"]}),s.each(function(){var s=$(this).data("coords").split(","),t=$(this).data("id");s[0]=parseFloat(s[0]),s[1]=parseFloat(s[1]),a[t]=new ymaps.Placemark(s,{balloonContentHeader:$(this).find(".js-item__name").html(),balloonContentBody:$(this).find(".js-item__descr").html()}),e.geoObjects.add(a[t])}),e.setBounds(e.geoObjects.getBounds(),{checkZoomRange:!0}),$("#rsMapShops").data("mapObj",e)}),s.on("mouseenter",function(){a[$(this).data("id")].options.set("preset","twirl#redDotIcon")}).on("mouseleave",function(){a[$(this).data("id")].options.set("preset","twirl#blueIcon")}),a}function rsGoproShops_initGoogleMaps(){var e=$(".js-shops_list").find(".js-item"),s=[0,0],t={},a=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|0b70ce",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),i=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|ed4443",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));e.each(function(){var e=$(this).data("coords").split(",");s[0]=s[0]+parseFloat(e[0]),s[1]=s[1]+parseFloat(e[1])}),s[0]=s[0]/e.length,s[1]=s[1]/e.length;var o,t={};return o=new google.maps.Map(document.getElementById("rsMapShops"),{zoom:10,center:{lat:s[0],lng:s[1]}}),$("#rsMapShops").data("mapObj",o),e.each(function(){var e=$(this).data("coords").split(","),s=$(this).data("id");e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),t[s]=new google.maps.Marker({position:{lat:e[0],lng:e[1]},title:$(this).find(".js-item__name").html(),icon:a,map:o})}),e.on("mouseenter",function(){t[$(this).data("id")].setIcon(i)}).on("mouseleave",function(){t[$(this).data("id")].setIcon(a)}),t}$(document).ready(function(){function e(e,s){var t=function(e,s){return s.replace(new RegExp("("+e+")","gi"),"<span>$1</span>")};e.each(function(e,a){var i=$(a),o=i.find(".js-item__name").html(),n=i.find(".js-item__descr").html();if(o=o.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"),n=n.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"),!s)return i.find(".js-item__name").html(o.replace(new RegExp("<span>(.*?)</span>","gi"),"$1")),void i.find(".js-item__descr").html(n.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"));o&&(o.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"),i.find(".js-item__name").html(t(s,o))),n&&(n.replace(new RegExp("<span>(.*?)</span>","gi"),"$1"),i.find(".js-item__descr").html(t(s,n)))})}var s={};void 0!=window.google?s=rsGoproShops_initGoogleMaps():void 0!=window.ymaps&&(s=rsGoproShops_initYandexMaps()),$(document).on("keyup",".js-search_city input",function(){var s,t,a,i,o=$(this),n=o.val(),p=$(".js-filter .js-btn.active").data("filter"),r=$([]);s=p?$(".js-shops_list .js-item[data-type="+p+"]"):$(".js-shops_list .js-item"),n&&""!=n.trim()?($(".js-clear-shops-input").addClass("active"),$.each(s,function(e,s){t=$(s),a=t.find(".js-item__name").text(),i=t.find(".js-item__descr").text(),(a&&-1!==a.toLowerCase().indexOf(n.toLowerCase())||i&&-1!==i.toLowerCase().indexOf(n.toLowerCase()))&&(r=r.add(t))})):(r=s,$(".js-clear-shops-input").removeClass("active")),s.addClass("hidden"),r.length>0?(r.removeClass("hidden"),$(".js-not-found:visible").hide()):$(".js-not-found:hidden").show(),e(r,n)}),$(document).on("click",".js-shops_list .js-item",function(){var e,s=$(this).data("coords");s&&(s=s.split(","),s=$.map(s,function(e){return parseFloat(e,10)}),e=$("#rsMapShops").data("mapObj"),void 0!=window.google?(e.setCenter({lat:s[0],lng:s[1]}),e.setZoom(14)):void 0!=window.ymaps&&e.setCenter(s,18))}),$(document).on("blur",".js-search_city input",function(){$(this).val().length<1?$(".js-shops_list").find(".js-item").show():$(".js-search_city input").trigger("keyup"),drawPlacemark(arShopsItem,s)}),$(document).on("click",".js-filter .js-btn",function(){$(".js-shops .js-filter").find(".js-btn").removeClass("active"),$(this).addClass("active");var e=$(this).data("filter");e.length>0?($(".js-shops_list").find(".js-item").hide(),$(".js-shops_list").find('.js-item[data-type="'+e+'"]').show()):$(".js-shops_list").find(".js-item").show(),$(".js-search_city input").trigger("keyup"),drawPlacemark(arShopsItem,s)}),$(document).on("click",".js-clear-shops-input",function(){$(".js-search_city .shops-input").val("").keyup()})});