appSLine.offerPropChangedTimeout=0,appSLine.catalogElementSetPrice=function(e,a){var t=e.find(".js-price_pdv-"+a.PRICE_ID);t&&(parseFloat(a.DISCOUNT_DIFF)>0?t.closest(".price").addClass("price-disc"):t.closest(".price").removeClass("price-disc"),t.html(a.PRINT_DISCOUNT_VALUE));var r=e.find(".js-price_pv-"+a.PRICE_ID);r&&(parseFloat(a.DISCOUNT_DIFF)>0?r.html(a.PRINT_VALUE):r.html(""));var i=e.find(".js-price_pdd-"+a.PRICE_ID);i&&(parseFloat(a.DISCOUNT_DIFF>0)?i.html(a.PRINT_DISCOUNT).show():i.html("").hide());var s=e.find(".js-price_pdp-"+a.PRICE_ID);s&&(parseFloat(a.DISCOUNT_DIFF_PERCENT)>0?s.html(a.DISCOUNT_DIFF_PERCENT):s.html(""))},appSLine.catalogElementSetPriceMatrix=function(e,a){var t=e.find(".js-quantity").val();for(var r in a.ROWS)if((0==a.ROWS[r].QUANTITY_FROM||a.ROWS[r].QUANTITY_FROM<=t)&&(0==a.ROWS[r].QUANTITY_TO||a.ROWS[r].QUANTITY_TO>=t)){for(var i in a.COLS)a.MATRIX[i][r]&&this.catalogElementSetPrice(e,{PRICE_ID:a.COLS[i].ID,PRINT_DISCOUNT_VALUE:a.MATRIX[i][r].PRINT_DISCOUNT_VALUE,PRINT_DISCOUNT:a.MATRIX[i][r].PRINT_DISCOUNT_DIFF,PRINT_VALUE:a.MATRIX[i][r].PRINT_VALUE,DISCOUNT_DIFF:a.MATRIX[i][r].DISCOUNT_DIFF});break}},appSLine.offerPropChanged=function(e){var a=e.closest(".js-product"),t=a.data("product-id"),r=appSLine.offers[t],i=e.closest(".js-offer_prop"),s=i.data("code"),o=i.closest(".js-product__offer_props");e.data("value");if(r&&!e.hasClass("disabled")){i.find(".offer_prop__value").removeClass("checked"),e.addClass("checked"),i.find(".offer_prop__checked").text(e.text());var _="",n="",d={};for(var f in r.SORT_PROPS)if(n=r.SORT_PROPS[f],d[n]=o.find('.offer_prop[data-code="'+n+'"]').find(".offer_prop__value.checked").data("value"),n==s){_=!!r.SORT_PROPS[parseInt(f)+1]&&r.SORT_PROPS[parseInt(f)+1];break}var l=o.find('.offer_prop[data-code="'+_+'"]:first');if(_&&l.length>0){var p=!0,S=new Array;for(var c in r.OFFERS){p=!0;e:for(var T in d)if(d[T]!=r.OFFERS[c].PROPERTIES[T]){p=!1;break e}p&&S.push(r.OFFERS[c].PROPERTIES[_])}l.find(".offer_prop__value").each(function(e){var a=$(this),t=!0;for(var r in S)if(a.data("value")==S[r]){t=!1;break}a.addClass("disabled"),t||a.removeClass("disabled")}),l.find(".offer_prop__value.checked").hasClass("disabled")?$nextOption=l.find(".offer_prop__value:not(.disabled):first"):$nextOption=l.find(".offer_prop__value.checked"),this.offerPropChanged($nextOption)}else this.catalogElementChangeOffer(a)}},appSLine.catalogElementChangeOffer=function(e){function a(e,a,t){return e=parseInt(e),a=parseInt(a),0==e?t[0]:e>=a?t[2]:t[1]}var t=e.data("product-id"),r=appSLine.offers[t];if(r){var i={};e.find(".js-product__offer_props:first").find(".offer_prop__value.checked").each(function(e){var a=$(this),t=a.closest(".js-offer_prop").data("code"),r=a.data("value")+"";i[t]=r});var s=0,o=!0;for(var _ in r.OFFERS){o=!0;for(var n in i)if(i[n]!==r.OFFERS[_].PROPERTIES[n]){o=!1;break}if(o){s=_;break}}if(void 0==r.OFFERS[s])return!1;e.trigger("offerChecked.rs");var d=r.OFFERS[s],f=e.find(".js-buy1click"),l=e.find(".js-add2cart");if(e.data("offer-id",s),e.find(".js-product_id").val(s),f.length){var p=BX.parseJSON(f.data("insert_data"));p.RS_ORDER_IDS=s,f.data("insert_data",JSON.stringify(p))}if(void 0!=d.DETAIL_PAGE_URL&&d.DETAIL_PAGE_URL.length>0&&e.find(".js-product__name,\t\t\t\t.catalog_item__detail,\t\t\t\t.catalog_item__zoom,\t\t\t\t.catalog_item__pic").attr("href",d.DETAIL_PAGE_URL),void 0!=d.IMAGES){var S=e.find(".picbox__carousel"),c=S.data("owl.carousel");if(S.length>0){var T=c.settings.smartSpeed,E="";for(var I in d.IMAGES)if("p"!=I){var A='<a class="picbox__canvas js-glass__canvas" data-fancybox="gallery" href="'+d.IMAGES[I].original+'" data-offer-id="'+s+"\" data-dot=\"<img class='owl-preview' src='"+d.IMAGES[I].smaller+'\'>">\t\t\t\t\t\t\t\t<img class="picbox__img" src="'+d.IMAGES[I].big+'">\t\t\t\t\t\t\t</a>';"d"==I?E=A+E:E+=A}for(var I in c._items){var R=c._items[I].children("a");1!=R.length||R.attr("data-offer-id")||(E+=c._items[I].html())}c._plugins.navigation._templates=[],c._plugins.navigation._controls.$absolute.html(""),c.settings.smartSpeed=0,S.trigger("replace.owl.carousel",[E]),setTimeout(function(){S.trigger("refresh.owl.carousel").trigger("to.owl.carousel",[0])},250),c.settings.smartSpeed=T}else{var O=["p","d",0];for(var I in O)if(void 0!=d.IMAGES[O[I]]){e.find(".catalog_item__img").attr("src",d.IMAGES[O[I]].small);break}}}if(void 0!=d.DISPLAY_PROPERTIES)for(var v in d.DISPLAY_PROPERTIES){var h=e.find(".sku_prop__val_"+v);h.length&&(h.html(d.DISPLAY_PROPERTIES[v].DISPLAY_VALUE),""==d.DISPLAY_PROPERTIES[v].DISPLAY_VALUE?(h.prev(".sku_prop__name").hide(),h.parent(".sku_prop").hide()):(h.prev(".sku_prop__name").show(),h.parent(".sku_prop").show()))}if(d.CATALOG_MEASURE_RATIO&&e.find(".js-quantity").data("ratio",d.CATALOG_MEASURE_RATIO).attr("step",d.CATALOG_MEASURE_RATIO).attr("min",d.CATALOG_MEASURE_RATIO).val(d.CATALOG_MEASURE_RATIO),d.CATALOG_MEASURE_NAME&&e.find(".js-measure").html(d.CATALOG_MEASURE_NAME),d.PRICE_MATRIX)this.catalogElementSetPriceMatrix(e,d.PRICE_MATRIX);else if(d.PRICES)for(var m in d.PRICES)this.catalogElementSetPrice(e,d.PRICES[m]);$timers=e.removeClass("qb da2").find(".js_timer, .rs_progress-wrap").hide(),r.ELEMENT.DAYSARTICLE2||d.DAYSARTICLE2?(e.addClass("da2"),$timers.filter('[data-offer-id="'+t+'"]').length>0?$timers.filter('[data-offer-id="'+t+'"]').show():$timers.filter('[data-offer-id="'+s+'"]').length>0&&$timers.filter('[data-offer-id="'+s+'"]').show()):(r.ELEMENT.QUICKBUY||d.QUICKBUY)&&(e.addClass("qb"),$timers.filter('[data-offer-id="'+t+'"]').length>0?$timers.filter('[data-offer-id="'+t+'"]').show():$timers.filter('[data-offer-id="'+s+'"]').length>0&&$timers.filter('[data-offer-id="'+s+'"]').show()),d.CAN_BUY?(f.removeClass("disabled"),l.removeClass("disabled"),e.find(".js-subscribe").hide()):(f.addClass("disabled"),l.addClass("disabled"),d.CATALOG_SUBSCRIBE&&(e.find(".js-subscribe").attr("data-item",s).show(),e.find(".js-subscribe_hidden").trigger("click")));var u=e.find(".stocks");if(u.length){var C=["is-outofstock","is-limited","is-instock"];if(r.PARAMS.USE_STORE&&void 0!=this.stocks[t]&&0!=this.stocks[t].STORES.length){var L=this.stocks[t],P=[L.MESSAGES.OUT_OF_STOCK,L.MESSAGES.LIMITED_AVAILABILITY,L.MESSAGES.IN_STOCK];u.find(".stocks__amount").text(L.USE_MIN_AMOUNT?a(L.SKU[s].TOTAL_AMOUNT,L.MIN_AMOUNT,P):L.SKU[s].TOTAL_AMOUNT);var g=u.find(".stocks__scale").removeClass("is-outofstock is-limited is-instock").addClass(a(L.SKU[s].TOTAL_AMOUNT,L.MIN_AMOUNT,C));0==L.SKU[s].MAX_AMOUNT?g.children(".scale__over").removeAttr("style"):g.children(".scale__over").css("width","100%");for(I in L.STORES){var M=u.find("#"+L.ID+"_"+L.STORES[I]);if(!L.SHOW_EMPTY_STORE&&L.SKU[s].STORES[L.STORES[I]]<=0)M.hide();else{M.find(".stock__quantity").text(L.USE_MIN_AMOUNT?a(L.SKU[s].STORES[L.STORES[I]],L.MIN_AMOUNT,P):L.SKU[s].STORES[L.STORES[I]]);var g=M.show().find(".stock__scale").removeClass("is-outofstock is-limited is-instock").addClass(a(L.SKU[s].STORES[L.STORES[I]],L.MIN_AMOUNT,C));0==L.SKU[s].MAX_AMOUNT?g.children(".scale__over").removeAttr("style"):g.children(".scale__over").css("width",100*L.SKU[s].STORES[L.STORES[I]]/L.SKU[s].MAX_AMOUNT+"%")}}}else{var P=[BX.message("RS_SLINE_STOCK_OUT_OF_STOCK"),BX.message("RS_SLINE_STOCK_LIMITED_AVAILABILITY"),BX.message("RS_SLINE_STOCK_IN_STOCK")];u.find(".stocks__amount").text(r.PARAMS.USE_MIN_AMOUNT?a(d.CATALOG_QUANTITY,r.PARAMS.MIN_AMOUNT,P):d.CATALOG_QUANTITY);var g=u.find(".stocks__scale").removeClass("is-outofstock is-limited is-instock").addClass(a(d.CATALOG_QUANTITY,r.PARAMS.MIN_AMOUNT,C));0==d.CATALOG_QUANTITY?g.children(".scale__over").removeAttr("style"):g.find(".scale__over").css("width","100%")}}$(".js-product__sets").children().hide().filter("#rs_set_"+s).show(),this.setProductItems({items:e})}},$(document).on("click",".js-product .js-offer_prop .offer_prop__value",function(e){var a=$(this);if(!a.hasClass("disabled")&&!a.hasClass("checked")){var t=a.closest(".js-product"),r=parseInt(t.data("product-id"));a.closest(".js-offer_prop");if(r>0)if(clearTimeout(appSLine.offerPropChangedTimeout),appSLine.offers[r])appSLine.offerPropChanged(a);else{var i=t.find(".js-product__name").attr("href"),s=t.children(".catalog_item__inner");void 0==i&&(i=void 0==t.data("detail")?window.location.href:t.data("detail")),s.length<1&&(s=t),s.rsToggleDark({progress:!0}),appSLine.offerPropChangedTimeout=setTimeout(function(){$.ajax({type:"POST",url:i,dataType:"json",data:{AJAX_CALL:"Y",action:"get_element_json"},success:function(e){appSLine.offers[r]=e,appSLine.offerPropChanged(a)},error:function(e,a,t){console.error(e.status),console.error(t)},complete:function(){s.rsToggleDark()}})},appSLine.ajaxTimeoutTime)}}}),$(document).on("change",".js-product .js-quantity.js-use_count",function(e){var a=$(this);if(!a.hasClass("disabled")){var t=a.closest(".js-product"),r=parseInt(t.data("product-id"));if(r>0)if(clearTimeout(appSLine.offerPropChangedTimeout),e.stopPropagation(),appSLine.offers[r]){var i=t.find(".js-product_id").val();void 0!=appSLine.offers[r].OFFERS[i]&&void 0!=appSLine.offers[r].OFFERS[i].PRICE_MATRIX?appSLine.catalogElementSetPriceMatrix(t,appSLine.offers[r].OFFERS[i].PRICE_MATRIX):void 0!=appSLine.offers[r].ELEMENT.PRICE_MATRIX&&appSLine.catalogElementSetPriceMatrix(t,appSLine.offers[r].ELEMENT.PRICE_MATRIX)}else{var s=t.find(".js-product__name").attr("href"),o=t.children(".catalog_item__inner");void 0==s&&(s=void 0==t.data("detail")?window.location.href:t.data("detail")),o.length<1&&(o=t),o.rsToggleDark({progress:!0}),appSLine.offerPropChangedTimeout=setTimeout(function(){$.ajax({type:"POST",url:s,dataType:"json",data:{AJAX_CALL:"Y",action:"get_element_json"},success:function(e){appSLine.offers[r]=e;var a=t.find(".js-product_id").val();appSLine.offers[r]&&(void 0!=appSLine.offers[r].OFFERS[a]&&void 0!=appSLine.offers[r].OFFERS[a].PRICE_MATRIX?appSLine.catalogElementSetPriceMatrix(t,appSLine.offers[r].OFFERS[a].PRICE_MATRIX):void 0!=appSLine.offers[r].ELEMENT.PRICE_MATRIX&&appSLine.catalogElementSetPriceMatrix(t,appSLine.offers[r].ELEMENT.PRICE_MATRIX))},error:function(){console.error(xhr.status),console.error(thrownError)},complete:function(){o.rsToggleDark()}})},appSLine.ajaxTimeoutTime)}else console.error("Get element JSON -> iProductID is empty")}return!1});